# 1. Redis 数据结构

### 6. 压缩列表 (ziplist)

压缩列表 (ziplist) 是列表键和哈希键的底层实现之一。当一个**列表键/哈希键** 只包含少量项，并且每个列表项要么是小整数值，要么是长度比较短的字符串，那么

Redis 就会使用压缩列表来做列表键的底层实现。



1. ##### 压缩列表 (ziplist) 的实现

压缩列表是 Redis 为了节约内存而开发的，是由一系列特殊编码的连续内存块组成的顺序型数据结构。一个压缩列表中可以包含多个节点 (entry)，每个节点可以

保存一个字节数组或者一个整数值。

![redis-Redis 压缩列表](D:%5Cnote%5Credis%5Credis-Redis%20%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8.png)

- 压缩列表

| 属性    | 类型     | 长度  | 用途                                                         |
| ------- | -------- | ----- | ------------------------------------------------------------ |
| zlbytes | uint32_t | 4字节 | 记录整个压缩列表占用的内存字节数：在对压缩列表进行内存重分配，<br />或者计算zlend的位置时使用。 |
| zltail  | uint32_t | 4字节 | 记录压缩列表表尾节点距离压缩列表的起始地址有多少字节：通过整个偏移量，<br />程序无需遍历整个压缩列表就可以确定表尾节点的地址。 |
| zllen   | uint16_t | 2字节 | 记录了压缩列表包含的节点数量，当这个属性的值小于 UINT16_MAX (65535) 时，<br />这个属性的值就是压缩列表包含的节点数量；当这个值等于 UINT16_MAX 时，节<br />点的真实数量需要遍历整个压缩列表才能计算出。 |
| entryX  | 列表节点 | 不定  | 压缩列表包含的各个节点，节点的长度有节点保存的内容决定       |
| zlend   | uint8_t  | 1字节 | 特殊值 (0xFF) (十进制 255)，用于标记压缩列表的末端。         |

- 压缩列表节点

可以保存一个字节数组或者一个整数值。

1. previous_entry_length

记录了压缩列表中前一个节点的长度

2. encoding

记录了节点的 content 保存的数据的类型以及长度。

2. content

保存节点值，可以是一个字节数组或者整数。



##### 2. 连锁更新

当保存的节点的前一个节点的长度类型发生变化时，后一个节点保存的 previous_entry_length 需要跟着发生变化。

